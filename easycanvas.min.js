/*!
 * VERSION: 0.1.0
 * DATE: 2015-08-25
 * GIT: https://github.com/shrekshrek/easycanvas
 * @author: Shrek.wang
 **/

!function(t){"function"==typeof define&&define.amd?define(["exports"],function(i){window.EC=t(i)}):"undefined"!=typeof exports?t(exports):window.EC=t({})}(function(t){var i=function(t){var i=[];for(var e in t)i.push(e);return i},e=function(t){var e=arguments.length;if(2>e||null==t)return t;for(var s=1;e>s;s++)for(var n=arguments[s],h=i(n),o=h.length,r=0;o>r;r++){var a=h[r];t[a]=n[a]}return t},s=function(t,i){var s,n=this;s=t&&Object.prototype.hasOwnProperty.call(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},e(s,n,i);var h=function(){this.constructor=s};return h.prototype=n.prototype,s.prototype=new h,t&&e(s.prototype,t),s.__super__=n.prototype,s};t.STROKE_CAPS_MAP=["butt","round","square"],t.STROKE_JOINTS_MAP=["miter","round","bevel"],t.TEXT_ALIGN_MAP=["center","end","left","right","start"],t.TEXT_BASELINE_MAP=["alphabetic","top","hanging","middle","ideographic","bottom"],t.Object=function(){this.initialize.apply(this,arguments)},e(t.Object.prototype,{x:0,y:0,position:function(t,i){switch(arguments.length){case 1:return this.x=t,this.y=t,this;case 2:return this.x=t,this.y=i,this}return this},move:function(t,i){switch(arguments.length){case 1:return this.x+=t,this.y+=t,this;case 2:return this.x+=t,this.y+=i,this}return this},rotation:0,rotate:function(t){switch(arguments.length){case 1:return this.rotation+=t,this}return this},scaleX:0,scaleY:0,scale:function(t,i){switch(arguments.length){case 1:return this.scaleX=t,this.scaleY=t,this;case 2:return this.scaleX=t,this.scaleY=i,this}return this},width:0,height:0,size:function(t,i){switch(arguments.length){case 1:return this.width=t,this.height=t,this;case 2:return this.width=t,this.height=i,this}return this},initialize:function(){this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.width=0,this.height=0,this.children=[]},destroy:function(){for(var t=this.children.length-1;t>=0;t--)this.children[t].destroy();this.children=[]},parent:null,children:null,index:null,addChild:function(t){t.parent&&t.parent.removeChild(t);var i=this.children.length;return t.parent=this,t.index=i,this.children[i]=t,this},addChildAt:function(t,i){t.parent&&t.parent.removeChild(t);var e=this.children.length,s=Math.max(0,Math.min(e-1,i));this.children.splice(s,0,t),t.parent=this;for(var n=e-1;n>=0;n--)this.children[n].index=n;return this},removeChild:function(t){if(t.parent===this){this.children.splice(t.index,1),t.parent=null,t.index=null;for(var i=this.children.length,e=i-1;e>=0;e--)this.children[e].index=e;return this}}}),t.Object.extend=s,t.Sprite=t.Object.extend({update:function(t){t&&(t.save(),this.transform(t),this.childUpdate(t),t.restore())},transform:function(t){t.translate(this.x,this.y),t.rotate(this.rotation*Math.PI/180),t.scale(this.scaleX,this.scaleY)},childUpdate:function(t){for(var i=this.children.length,e=0;i>e;e++){var s=this.children[e];s.update(t)}}}),t.Stage=t.Sprite.extend({el:null,ctx:null,mask:null,initialize:function(i){t.Stage.__super__.initialize.apply(this,[i]);var e;e=i&&i.el?i.el:document.createElement("canvas"),this.ctx=e.getContext("2d"),this.el=e,e.le=this},update:function(){return this.ctx.clearRect(0,0,this.el.width,this.el.height),this.ctx.save(),this.childUpdate(this.ctx),this.ctx.restore(),null!=this.mask&&(this.ctx.globalCompositeOperation="destination-in",this.mask.update(this.ctx),this.ctx.globalCompositeOperation="source-over"),this}}),t.Bitmap=t.Sprite.extend({image:null,initialize:function(i){t.Stage.__super__.initialize.apply(this,[i]),i&&i.image&&(this.image=i.image),this.originX=.5,this.originY=.5},update:function(t){t&&(t.save(),this.transform(t),t.drawImage(this.image,-this.image.width*this.originX,-this.image.height*this.originY,this.image.width,this.image.height),this.childUpdate(t),t.restore())},originX:0,originY:0,origin:function(t,i){switch(arguments.length){case 1:return this.originX=Math.max(0,Math.min(1,t)),this.originY=Math.max(0,Math.min(1,t)),this;case 2:return this.originX=Math.max(0,Math.min(1,t)),this.originY=Math.max(0,Math.min(1,i)),this}return this}}),t.Graphic=t.Sprite.extend({actions:[],initialize:function(i){t.Graphic.__super__.initialize.apply(this,[i]),this.actions=[]},update:function(t){t&&(t.save(),this.transform(t),this.updateG(t),this.childUpdate(t),t.restore())},updateG:function(t){for(var i=this.actions.length,e=0;i>e;e++)this.actions[e].update(t)},clear:function(){this.actions=[]},fill:function(t){this.actions.push(new n.fill(t))},strokeStyle:function(t,i,e,s,h){this.actions.push(new n.strokeStyle(t,i,e,s,h))},stroke:function(t){this.actions.push(new n.stroke(t))},moveTo:function(t,i){this.actions.push(new n.moveTo(t,i))},lineTo:function(t,i){this.actions.push(new n.lineTo(t,i))},arcTo:function(t,i,e,s,h){this.actions.push(new n.arcTo(t,i,e,s,h))},arc:function(t,i,e,s,h,o){this.actions.push(new n.arc(t,i,e,s,h,o))},quadraticCurveTo:function(t,i,e,s){this.actions.push(new n.quadraticCurveTo(t,i,e,s))},bezierCurveTo:function(t,i,e,s,h,o){this.actions.push(new n.bezierCurveTo(t,i,e,s,h,o))},rect:function(t,i,e,s){this.actions.push(new n.rect(t,i,e,s))},closePath:function(){this.actions.push(new n.closePath)},beginPath:function(){this.actions.push(new n.beginPath)},circle:function(t,i,e){this.actions.push(new n.circle(t,i,e))},ellipse:function(t,i,e,s){this.actions.push(new n.ellipse(t,i,e,s))}}),t.Text=t.Sprite.extend({actions:[],initialize:function(i){t.Text.__super__.initialize.apply(this,[i]),this.actions=[]},update:function(t){t&&(t.save(),this.transform(t),this.updateG(t),this.childUpdate(t),t.restore())},updateG:function(t){for(var i=this.actions.length,e=0;i>e;e++)this.actions[e].update(t)},clear:function(){this.actions=[]},fontStyle:function(t,i,e){this.actions.push(new n.fontStyle(t,i,e))},fillText:function(t,i,e,s){this.actions.push(new n.fillText(t,i,e,s))},strokeText:function(t,i,e,s){this.actions.push(new n.strokeText(t,i,e,s))}});var n={};return(n.fill=function(t){this.style=t}).prototype.update=function(t){t.fillStyle=this.style,t.fill()},(n.strokeStyle=function(t,i,e,s,n){this.width=t,this.caps=i,this.joints=e,this.miterLimit=s,this.ignoreScale=n}).prototype.update=function(i){i.lineWidth=null==this.width?"1":this.width,i.lineCap=null==this.caps?"butt":isNaN(this.caps)?this.caps:t.STROKE_CAPS_MAP[this.caps],i.lineJoin=null==this.joints?"miter":isNaN(this.joints)?this.joints:t.STROKE_JOINTS_MAP[this.joints],i.miterLimit=null==this.miterLimit?"10":this.miterLimit,i.ignoreScale=null==this.ignoreScale?!1:this.ignoreScale},(n.stroke=function(t){this.style=t}).prototype.update=function(t){t.strokeStyle=this.style,t.stroke()},(n.moveTo=function(t,i){this.x=t,this.y=i}).prototype.update=function(t){t.moveTo(this.x,this.y)},(n.lineTo=function(t,i){this.x=t,this.y=i}).prototype.update=function(t){t.lineTo(this.x,this.y)},(n.arcTo=function(t,i,e,s,n){this.x1=t,this.y1=i,this.x2=e,this.y2=s,this.radius=n}).prototype.update=function(t){t.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)},(n.arc=function(t,i,e,s,n,h){this.x=t,this.y=i,this.radius=e,this.startAngle=s,this.endAngle=n,this.anticlockwise=!!h}).prototype.update=function(t){t.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},(n.quadraticCurveTo=function(t,i,e,s){this.cpx=t,this.cpy=i,this.x=e,this.y=s}).prototype.update=function(t){t.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)},(n.bezierCurveTo=function(t,i,e,s,n,h){this.cp1x=t,this.cp1y=i,this.cp2x=e,this.cp2y=s,this.x=n,this.y=h}).prototype.update=function(t){t.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)},(n.rect=function(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}).prototype.update=function(t){t.rect(this.x,this.y,this.w,this.h)},(n.closePath=function(){}).prototype.update=function(t){t.closePath()},(n.beginPath=function(){}).prototype.update=function(t){t.beginPath()},(n.circle=function(t,i,e){this.x=t,this.y=i,this.radius=e}).prototype.update=function(t){t.arc(this.x,this.y,this.radius,0,2*Math.PI)},(n.ellipse=function(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}).prototype.update=function(t){var i=this.x,e=this.y,s=this.w,n=this.h,h=.5522848,o=s/2*h,r=n/2*h,a=i+s,c=e+n,u=i+s/2,l=e+n/2;t.moveTo(i,l),t.bezierCurveTo(i,l-r,u-o,e,u,e),t.bezierCurveTo(u+o,e,a,l-r,a,l),t.bezierCurveTo(a,l+r,u+o,c,u,c),t.bezierCurveTo(u-o,c,i,l+r,i,l)},(n.fontStyle=function(t,i,e){this.font=t,this.textAlign=i,this.textBaseline=e}).prototype.update=function(i){i.font=null==this.font?"1":this.font,i.textAlign=null==this.textAlign?"start":isNaN(this.textAlign)?this.textAlign:t.TEXT_ALIGN_MAP[this.textAlign],i.textBaseline=null==this.textBaseline?"alphabetic":isNaN(this.textBaseline)?this.textBaseline:t.TEXT_BASELINE_MAP[this.textBaseline]},(n.fillText=function(t,i,e,s){this.text=t,this.x=i,this.y=e,this.maxWidth=s}).prototype.update=function(t){t.fillText(this.text,this.x,this.y,this.maxWidth)},(n.strokeText=function(t,i,e,s){this.text=t,this.x=i,this.y=e,this.maxWidth=s}).prototype.update=function(t){t.strokeText(this.text,this.x,this.y,this.maxWidth)},t});
